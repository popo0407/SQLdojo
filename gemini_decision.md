# 説明ウィンドウ分離の実装方針決定

## 改善方針

### 1. フローティングウィンドウ方式への変更

- **理由**: 本体画面と説明ウィンドウのスクロール領域を完全に分離するため
- **実装**: 説明ウィンドウを独立した div 要素として実装し、position: fixed で画面右下に固定

### 2. レイアウト構造の変更

- **理由**: 現在の下部固定方式から、独立したウィンドウ方式に変更
- **実装**:
  - 既存の説明スペースを削除
  - 新しいフローティングウィンドウを追加
  - 本体画面の高さ制限を解除

### 3. スクロール分離の実装

- **理由**: ユーザーが本体画面と説明ウィンドウを独立して操作できるようにするため
- **実装**:
  - 本体画面: 通常のスクロール動作を維持
  - 説明ウィンドウ: 独立したスクロール領域を設定

### 4. レスポンシブ対応の調整

- **理由**: 異なる画面サイズでも適切に表示されるようにするため
- **実装**:
  - デスクトップ: 固定サイズのフローティングウィンドウ
  - モバイル: 画面下部に固定表示（現在の方式を維持）

### 問題の根本原因

- エディタ最小化時に results-container の高さが変化し、DOM 描画が完了する前に insertDummyResults()が実行される
- setTimeout による遅延では根本解決にならない

### 解決策

- requestAnimationFrame を使用して複数フレーム後にダミーデータを挿入
- これにより DOM 描画が完了した後に確実にダミーデータが表示される

### 実装内容

1. showCurrentStep()で実行結果ステップの場合、requestAnimationFrame で 3 フレーム後に insertDummyResults()を呼び出し
2. showIndividualExplanation()でも同様の処理を適用
3. 既存の setTimeout は削除

### 理由

- requestAnimationFrame はブラウザの描画サイクルに合わせて実行されるため、DOM 更新完了後に確実に実行される
- 複数フレーム待つことで、エディタ最小化によるレイアウト変更が完全に完了する
- 開発憲章の「問題特定と修正」に従い、根本原因を特定して適切な解決策を実装

## 開発憲章準拠の注意点

### 1. 本番機能の絶対保護

- 既存の説明機能の動作を完全に維持
- 説明データ、ナビゲーション、キーボードショートカットは変更しない

### 2. 段階的実装

- 第 1 段階: レイアウト構造の変更（HTML/CSS）
- 第 2 段階: スクロール分離の実装
- 第 3 段階: レスポンシブ対応の調整
- 第 4 段階: テストと動作確認

### 3. 影響範囲の管理

- HTML テンプレート（base.html, index.html, user.html）の修正
- CSS（style.css）の修正
- JavaScript（explanationService.js）の最小限の修正

### 4. テスト駆動開発

- 既存の説明機能テストを維持
- 新しいレイアウトのテストを追加
- レスポンシブ対応のテストを追加

## 実装手順

1. **HTML 構造の変更**: 説明スペースをフローティングウィンドウに変更
2. **CSS 調整**: position: fixed、z-index、サイズ設定
3. **スクロール分離**: overflow 設定の調整
4. **レスポンシブ対応**: メディアクエリの追加
5. **テスト実行**: 既存機能の動作確認
