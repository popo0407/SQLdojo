# Gemini Consultation - SQL 作成補助 UI の改善（修正版）

## 相談内容

### 現在の問題

SQL 作成補助 UI で、テーブルのチェックボックスの動作に問題があります：

1. **テーブルのチェックを外したときにテーブルが閉じてカラムが見えなくなる**

   - 現在：チェック OFF → テーブルが閉じる
   - 要求：チェック OFF → テーブルは開いたまま

2. **テーブルのチェックを入れた時は必ずテーブルが開いてカラムが見える**
   - 現在：チェック ON → テーブルの状態は変わらない
   - 要求：チェック ON → 必ずテーブルが展開される

### 技術的な要件

- JavaScript/DOM 操作での実装
- 既存のチェックボックス機能は維持
- テーブルの開閉状態とチェックボックスの状態を独立管理
- 開発憲章（SRP/SoC/DRY/既存機能の保護）に合致

### 現在の実装状況

- `handleTableCheckboxChange()` でチェックボックスの状態管理
- テーブルの開閉は `tableHeader.addEventListener('click')` で管理
- `expandTable()` メソッドを追加してチェック ON 時にテーブル展開を実装
- **問題**: チェック OFF 時にテーブルが閉じてしまう問題が解決されていない

### 実装した修正内容

```javascript
handleTableCheckboxChange(checkbox) {
    // ... 既存の処理 ...
    if (isChecked) {
        // テーブルを必ず展開する
        this.expandTable(tableName, schemaName);
    } else {
        // チェックを外してもテーブルは閉じない（開閉状態は維持）
    }
}

expandTable(tableName, schemaName) {
    // テーブルヘッダーを探して展開処理
}
```

## 相談事項

1. **チェック OFF 時の問題解決**

   - 現在の実装ではチェック OFF 時にテーブルが閉じてしまう
   - チェックボックスの状態変更がテーブル開閉に影響しない方法
   - イベントの伝播制御の最適な方法

2. **根本的な原因の特定**

   - なぜチェック OFF 時にテーブルが閉じるのか
   - 他のイベントハンドラーとの競合
   - DOM 操作の順序やタイミングの問題

3. **最適な修正方針**
   - 既存機能を壊さない安全な修正方法
   - 開発憲章（SRP/SoC/DRY）に合致する実装
   - 段階的な修正アプローチ

## 期待する回答

- 問題の根本原因の分析
- 具体的な修正方針
- コード修正のポイント
- 開発憲章への適合性の評価
- リスクと対策
